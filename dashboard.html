<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMARTHOMES-MALL Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK (Make sure to replace with your actual Firebase project configuration) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <header>
          <img src="pictures/WhatsApp Image 2025-08-26 at 9.25.15 PM (2).jpeg" alt="SMARTHOMES-MALL Logo" width="50px" height="50px"   class="dashboard-logo">
            <h1>SMARTHOMES-MALL Dashboard</h1>
                <div class="header-content"> <!-- Add a div to better organize header elements -->
              <h1>SMARTHOMES-MALL Dashboard</h1>
                      
              <div class="dashboard-logo">  <!-- Add this line for the logo -->
            </div>
            <nav>
                <ul id="main-nav">
                    <li class="stock-manager-only"><a href="product.html">Add New Product</a></li>
                    <li><a href="pos.htm">Point of Sales</a></li>
                    <li class="stock-manager-only"><a href="report.html">Reports</a></li>
                    <li><a href="login.html" id="logout-btn">Logout</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <section id="dashboard-summary">
                <h2>Welcome, <span id="user-name"></span> (<span id="user-role"></span>)!</h2>
                <div class="summary-cards">
                    <div class="card low-stock-alert stock-manager-only">
                        <h3>Low Stock Alerts</h3>
                        <p id="low-stock-count">0 items</p>
                        <ul id="low-stock-list"></ul>
                    </div>
                    <div class="card recent-sales">
                        <h3>Recent Sales</h3>
                        <p id="recent-sales-count">0 sales</p>
                        <ul id="recent-sales-list"></ul>
                    </div>
                    <div class="card inventory-value stock-manager-only">
                        <h3>Total Inventory Value</h3>
                        <p id="inventory-value">$0.00</p>
                    </div>
                </div>
            </section>

            <section id="product-list-section">
                <h2>Product List</h2>
                <table id="product-table">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Stock</th>
                            <th>Price</th>
                            <th class="stock-manager-only">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="product-table-body">
                        <!-- Product data will be loaded here by JavaScript -->
                    </tbody>
                </table>
            </section>
        </main>

        <footer>
            <p>&copy; 2023 SMARTHOMES-MALL. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(); // Or firebase.database() for Realtime Database

        // Function to simulate user login session and role
        // In a real application, this would come from an actual login process
        function getLoggedInUser() {
            // For demonstration, hardcoding a user. Replace with actual session management.
            // Example: localStorage.getItem('userRole')
            const user = {
                name: "John Doe",
                role: "Stock Manager" // or "Customer Care"
            };
            return user;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = getLoggedInUser();
            const userNameSpan = document.getElementById('user-name');
            const userRoleSpan = document.getElementById('user-role');
            const stockManagerOnlyElements = document.querySelectorAll('.stock-manager-only');
            const logoutBtn = document.getElementById('logout-btn');

            if (!currentUser) {
                // Redirect to login page if no user is logged in
                window.location.href = 'login.html';
                return;
            }

            userNameSpan.textContent = currentUser.name;
            userRoleSpan.textContent = currentUser.role;

            // Role-based access control
            if (currentUser.role === 'Customer Care') {
                stockManagerOnlyElements.forEach(el => el.style.display = 'none');
            }

            // Logout functionality
            logoutBtn.addEventListener('click', () => {
                // In a real app, you would sign out from Firebase Auth here
                // firebase.auth().signOut().then(() => {
                //     localStorage.removeItem('userRole'); // Clear session
                //     window.location.href = 'login.html';
                // });
                alert('Logging out (demo)');
                window.location.href = 'login.html'; // Redirect to login page
            });

            // Fetch and display real-time data
            fetchDashboardData();
        });

        async function fetchDashboardData() {
            const lowStockList = document.getElementById('low-stock-list');
            const lowStockCount = document.getElementById('low-stock-count');
            const recentSalesList = document.getElementById('recent-sales-list');
            const recentSalesCount = document.getElementById('recent-sales-count');
            const inventoryValueElement = document.getElementById('inventory-value');
            const productTableBody = document.getElementById('product-table-body');

            // --- Fetch Products ---
            let totalInventoryValue = 0;
            let lowStockItems = [];
            let products = [];

            try {
                const productsSnapshot = await db.collection('products').get();
                productsSnapshot.forEach(doc => {
                    const product = doc.data();
                    products.push({ id: doc.id, ...product });

                    // Calculate total inventory value
                    if (product.stock && product.price) {
                        totalInventoryValue += product.stock * product.price;
                    }

                    // Check for low stock (example: less than 10 units)
                    if (product.stock < 10) {
                        lowStockItems.push(product);
                    }
                });
            } catch (error) {
                console.error("Error fetching products: ", error);
            }

            // Display low stock alerts
            if (lowStockItems.length > 0) {
                lowStockCount.textContent = `${lowStockItems.length} items`;
                lowStockItems.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `${item.name} (${item.stock} left)`;
                    lowStockList.appendChild(li);
                });
            } else {
                lowStockCount.textContent = 'No low stock items';
            }

            // Display total inventory value
            inventoryValueElement.textContent = `$${totalInventoryValue.toFixed(2)}`;

            // Display products in the table
            productTableBody.innerHTML = ''; // Clear existing rows
            products.forEach(product => {
                const row = productTableBody.insertRow();
                row.insertCell().textContent = product.name;
                row.insertCell().textContent = product.stock;
                row.insertCell().textContent = `$${product.price.toFixed(2)}`;

                const actionsCell = row.insertCell();
                actionsCell.classList.add('stock-manager-only'); // Apply role-based visibility
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.onclick = () => alert(`Edit ${product.name}`); // Replace with actual edit logic
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => alert(`Delete ${product.name}`); // Replace with actual delete logic
                actionsCell.appendChild(editButton);
                actionsCell.appendChild(deleteButton);
            });

            // Re-apply role-based access for dynamically added content
            const currentUser = getLoggedInUser();
            if (currentUser.role === 'Customer Care') {
                document.querySelectorAll('#product-table-body .stock-manager-only').forEach(el => el.style.display = 'none');
            }


            // --- Fetch Recent Sales (example structure) ---
            let sales = [];
            try {
                // Assuming a 'sales' collection with fields like 'productName', 'quantity', 'timestamp'
                const salesSnapshot = await db.collection('sales').orderBy('timestamp', 'desc').limit(5).get();
                salesSnapshot.forEach(doc => {
                    sales.push(doc.data());
                });
            } catch (error) {
                console.error("Error fetching sales: ", error);
            }

            if (sales.length > 0) {
                recentSalesCount.textContent = `${sales.length} sales`;
                recentSalesList.innerHTML = '';
                sales.forEach(sale => {
                    const li = document.createElement('li');
                    const saleDate = sale.timestamp ? new Date(sale.timestamp.toDate()).toLocaleString() : 'N/A';
                    li.textContent = `${sale.productName} x ${sale.quantity} on ${saleDate}`;
                    recentSalesList.appendChild(li);
                });
            } else {
                recentSalesCount.textContent = 'No recent sales';
            }
        }

        // You would typically have a 'login.html' for user authentication
        // and 'add-product.html', 'pos.html', 'reports.html' for other functionalities.
        // These would also use Firebase for data interaction.
    </script>
</body>
</html>

